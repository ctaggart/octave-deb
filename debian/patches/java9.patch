Description: Fix FTBFS against Java 9
Origin: backport, https://hg.savannah.gnu.org/hgweb/octave/rev/20c83f619102
Bug: http://savannah.gnu.org/bugs/?func=detailitem&item_id=51803
Bug-Debian: https://bugs.debian.org/873996
Reviewed-by: SÃ©bastien Villemot <sebastien@debian.org>
Last-Update: 2017-09-10
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/libinterp/octave-value/ov-java.cc
+++ b/libinterp/octave-value/ov-java.cc
@@ -190,7 +190,7 @@ namespace octave
 
     JVMArgs (void)
     {
-      vm_args.version = JNI_VERSION_1_2;
+      vm_args.version = JNI_VERSION_1_6;
       vm_args.nOptions = 0;
       vm_args.options = 0;
       vm_args.ignoreUnrecognized = false;
@@ -590,12 +590,12 @@ initialize_jvm (void)
       // At least one JVM exists, try to attach to it
 
       switch (jvm->GetEnv (reinterpret_cast<void **> (&current_env),
-                           JNI_VERSION_1_2))
+                           JNI_VERSION_1_6))
         {
         case JNI_EDETACHED:
           // Attach the current thread
           JavaVMAttachArgs vm_args;
-          vm_args.version = JNI_VERSION_1_2;
+          vm_args.version = JNI_VERSION_1_6;
           vm_args.name = const_cast<char *> ("octave");
           vm_args.group = 0;
           if (jvm->AttachCurrentThread (reinterpret_cast<void **> (&current_env),
@@ -709,7 +709,7 @@ thread_jni_env (void)
   JNIEnv *env = 0;
 
   if (jvm)
-    jvm->GetEnv (reinterpret_cast<void **> (&env), JNI_VERSION_1_2);
+    jvm->GetEnv (reinterpret_cast<void **> (&env), JNI_VERSION_1_6);
 
   return env;
 }
--- a/scripts/java/module.mk
+++ b/scripts/java/module.mk
@@ -35,7 +35,10 @@ scripts_java_JAVA_CLASSES = $(addprefix
 
 $(scripts_java_JAVA_CLASSES) : %.class : %.java | scripts/java/$(octave_dirstamp)
 	$(AM_V_GEN)$(MKDIR_P) scripts/java/$(org_octave_dir) && \
-		( cd $(srcdir)/scripts/java; "$(JAVAC)" -source 1.3 -target 1.3 -Xlint:-options -d $(abs_top_builddir)/scripts/java $(org_octave_dir)/$(<F) )
+	( cd $(srcdir)/scripts/java; \
+	  "$(JAVAC)" -source 1.6 -target 1.6 -Xlint:-options \
+	             -d $(abs_top_builddir)/scripts/java \
+	             $(org_octave_dir)/$(<F) )
 
 scripts/java/octave.jar: $(scripts_java_JAVA_CLASSES)
 	$(AM_V_GEN)rm -f $@-t $@ && \
